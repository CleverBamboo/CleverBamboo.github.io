<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载) - 聪明的竹子博客</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="聪明的竹子博客"><meta name="msapplication-TileImage" content="https://i.loli.net/2019/12/05/7WUKpFrsMSxv9jB.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="聪明的竹子博客"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="摘要最近，每天第一次打开简书都会跳转到一个恶意网页，它以浏览器错误问题引导用户下载一个安装包。这个安装包安全性未知。另外打开网页时还会自动向剪贴板中写入一个淘口令，打开淘宝的时候会自动打开一个红包。页面跳转似乎是同一个 IP 每天只有第一次会触发，自动复制淘口令每次都会触发。另外，恶意网页的域名隔一段时间会更换。 经过分析得出，此问题准确来说不算是网页劫持，而是简书自己的一个广告供应商的问题。恶意"><meta property="og:type" content="blog"><meta property="og:title" content="简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载)"><meta property="og:url" content="http://example.com/2019/12/24/Web/%E7%AE%80%E4%B9%A6%E7%BD%91%E9%A1%B5%E5%8A%AB%E6%8C%81%E5%88%86%E6%9E%90%EF%BC%8C%E4%BD%BF%E7%94%A8-Chrome-DevTools-%E8%B0%83%E8%AF%95-JavaScript-%E6%8A%80%E5%B7%A7%EF%BC%8C%E5%88%A9%E7%94%A8-CSP-%E9%A2%84%E9%98%B2%E5%8A%AB%E6%8C%81/"><meta property="og:site_name" content="聪明的竹子博客"><meta property="og:description" content="摘要最近，每天第一次打开简书都会跳转到一个恶意网页，它以浏览器错误问题引导用户下载一个安装包。这个安装包安全性未知。另外打开网页时还会自动向剪贴板中写入一个淘口令，打开淘宝的时候会自动打开一个红包。页面跳转似乎是同一个 IP 每天只有第一次会触发，自动复制淘口令每次都会触发。另外，恶意网页的域名隔一段时间会更换。 经过分析得出，此问题准确来说不算是网页劫持，而是简书自己的一个广告供应商的问题。恶意"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.iyunying.org/wp-content/uploads/2018/03/yunying-1520230972.png"><meta property="article:published_time" content="2019-12-24T02:04:31.000Z"><meta property="article:modified_time" content="2021-07-10T03:23:27.000Z"><meta property="article:author" content="聪明的竹子"><meta property="article:tag" content="前端"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://www.iyunying.org/wp-content/uploads/2018/03/yunying-1520230972.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2019/12/24/Web/%E7%AE%80%E4%B9%A6%E7%BD%91%E9%A1%B5%E5%8A%AB%E6%8C%81%E5%88%86%E6%9E%90%EF%BC%8C%E4%BD%BF%E7%94%A8-Chrome-DevTools-%E8%B0%83%E8%AF%95-JavaScript-%E6%8A%80%E5%B7%A7%EF%BC%8C%E5%88%A9%E7%94%A8-CSP-%E9%A2%84%E9%98%B2%E5%8A%AB%E6%8C%81/"},"headline":"简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载)","image":["https://www.iyunying.org/wp-content/uploads/2018/03/yunying-1520230972.png"],"datePublished":"2019-12-24T02:04:31.000Z","dateModified":"2021-07-10T03:23:27.000Z","author":{"@type":"Person","name":"聪明的竹子"},"publisher":{"@type":"Organization","name":"聪明的竹子博客","logo":{"@type":"ImageObject","url":"https://i.loli.net/2019/12/05/7WUKpFrsMSxv9jB.png"}},"description":"摘要最近，每天第一次打开简书都会跳转到一个恶意网页，它以浏览器错误问题引导用户下载一个安装包。这个安装包安全性未知。另外打开网页时还会自动向剪贴板中写入一个淘口令，打开淘宝的时候会自动打开一个红包。页面跳转似乎是同一个 IP 每天只有第一次会触发，自动复制淘口令每次都会触发。另外，恶意网页的域名隔一段时间会更换。 经过分析得出，此问题准确来说不算是网页劫持，而是简书自己的一个广告供应商的问题。恶意"}</script><link rel="canonical" href="http://example.com/2019/12/24/Web/%E7%AE%80%E4%B9%A6%E7%BD%91%E9%A1%B5%E5%8A%AB%E6%8C%81%E5%88%86%E6%9E%90%EF%BC%8C%E4%BD%BF%E7%94%A8-Chrome-DevTools-%E8%B0%83%E8%AF%95-JavaScript-%E6%8A%80%E5%B7%A7%EF%BC%8C%E5%88%A9%E7%94%A8-CSP-%E9%A2%84%E9%98%B2%E5%8A%AB%E6%8C%81/"><link rel="icon" href="https://i.loli.net/2019/12/05/7WUKpFrsMSxv9jB.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-4136865331374316" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://i.loli.net/2019/12/05/7WUKpFrsMSxv9jB.png" alt="聪明的竹子博客" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/CleverBamboo?tab=repositories"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://www.iyunying.org/wp-content/uploads/2018/03/yunying-1520230972.png" alt="简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载)"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-12-24T02:04:31.000Z" title="2019/12/24上午10:04:31">2019-12-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-07-10T03:23:27.000Z" title="2021/7/10上午11:23:27">2021-07-10</time></span><span class="level-item"><a class="link-muted" href="/categories/Web/">Web</a></span><span class="level-item">an hour read (About 9925 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载)</h1><div class="content"><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>最近，每天第一次打开简书都会跳转到一个恶意网页，它以浏览器错误问题引导用户下载一个安装包。这个安装包安全性未知。另外打开网页时还会自动向剪贴板中写入一个淘口令，打开淘宝的时候会自动打开一个红包。页面跳转似乎是同一个 IP 每天只有第一次会触发，自动复制淘口令每次都会触发。另外，恶意网页的域名隔一段时间会更换。</p>
<p>经过分析得出，此问题准确来说不算是网页劫持，而是简书自己的一个广告供应商的问题。恶意代码是直接嵌入正常业务代码的，排除了被劫持的可能。由于已经持续很长一段时间了，所以说不定是简书默许了这个行为。此外，CSDN 似乎某些情况下也有这个问题（不确定）。</p>
<p>文章末尾介绍了使用 CSP (Content Security Policy) 预防页面劫持的方法。</p>
<p><strong>关键词：</strong> 简书 劫持 网页 广告 恶意跳转 分析 DevTools 调试 JavaScript 指纹 Canvas Fingerprint CSP Cookie webpack</p>
<p><strong>注意：</strong> 如果想知道如何劫持 HTTPS 网页的，抱歉这里没有，目前也不太可能出现 HTTPS 网页劫持或证书劫持的问题。</p>
<span id="more"></span>
<h2 id="问题引出"><a href="#问题引出" class="headerlink" title="问题引出"></a>问题引出</h2><p>最近（其实已经很长时间了），每天第一次打开简书都会跳转到一个恶意网页，它以浏览器错误问题引导用户下载一个安装包。这个安装包安全性未知。另外打开网页时还会自动向剪贴板中写入一个淘口令，打开淘宝的时候会自动打开一个红包。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061752phg5ztz43qr3v1kp.gif" alt="简书页面劫持演示动画"></p>
<p>页面跳转似乎是同一个 IP 每天只有第一次会触发，自动复制淘口令每次都会触发。</p>
<p>因为用电脑访问并不会出现任何问题，所以我曾经一度以为是我的手机中病毒了。iOS 也不会触发，他们似乎仅针对 Android 手机。</p>
<p>所以我就用电脑对网页的脚本分析了一下，这里把分析过程分享给大家。说白了就是内嵌了一段 js 脚本（不过里面能发现很多有趣的东西）。这篇文章的主要目的也是介绍一些 JavaScript 的调试技巧。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>抓包</li>
<li>分析 js 代码依赖关系</li>
<li>格式化代码</li>
<li>分析代码逻辑与目的</li>
<li>为什么会出现这种问题</li>
<li>前端开发者如何预防这种问题</li>
<li>其他相关的思考与感想</li>
</ul>
<h2 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h2><p>打开 Chrome 浏览器，按 F12 打开 Chrome DevTools（Chrome 开发者工具），切换到 Network 标签中勾选 Preseve log，然后访问一个简书的网页。</p>
<blockquote>
<p>网页是我在 Bing 上随便找到 <a target="_blank" rel="noopener" href="https://cn.bing.com/search?q=site:jianshu.com">site:jianshu.com - 国内版 Bing</a></p>
</blockquote>
<p>等待页面加载完成。简单浏览一下域名，看看有没有外部脚本。</p>
<p>似乎 PC 端不太行，那个页面似乎只能在安卓端触发，这里采用一种方法模拟一下手机端。点击开发者工具左上角的手机图标，然后在网页上方多出的工具栏中选择一个 Android 机型，刷新页面再看看。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061758xphmpv3vu3zr651g.png" alt="模拟 Android 浏览器"></p>
<p>这里有一个小技巧，右键列表的表头，勾选 Domain。然后按照域名排序，你就可以轻松忽略大量相同域名的文件了。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061802if2cb577fcbhn24f.png" alt="在 Network 标签打开域名"></p>
<p>我们似乎有意外发现，来自非简书的域名</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061806zmmly3rc0erje1bt.png" alt="来自非简书的域名"></p>
<p>卧槽！这么多奇奇怪怪名字的域名，一看就不是什么好东西。这得有多少使用简书的人被这帮恶意脚本 X 啊。</p>
<h2 id="分析-js-代码依赖关系"><a href="#分析-js-代码依赖关系" class="headerlink" title="分析 js 代码依赖关系"></a>分析 js 代码依赖关系</h2><p><img src="https://attach.52pojie.cn/forum/201912/09/061810w6536132ppb4z1z5.png" alt="找到资源的发起者"></p>
<p>我们可以看到文件是这样加载的</p>
<blockquote>
<p>为了防止不必要的外链风险，文中所有的域名均使用下划线 <code>_</code> 代替了点 <code>.</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www_jianshu_com&#x2F;p&#x2F;bc916e388452</span><br><span class="line">    https:&#x2F;&#x2F;cdn2_jianshu_io&#x2F;asimov&#x2F;2.c90dbb2ede007dc39cbf.js</span><br><span class="line">        https:&#x2F;&#x2F;ox86_xu7b_com&#x2F;m301650.js</span><br><span class="line">            https:&#x2F;&#x2F;s9_cnzz_com&#x2F;z_stat.php?id&#x3D;1277879054&amp;web_id&#x3D;1277879054</span><br><span class="line">            https:&#x2F;&#x2F;ws2_hbssjd_cn&#x2F;ms&#x2F;a.js?b&#x3D;200473!301650!88!640!150!200&amp;u&#x3D;5!5.0!0!1!c20tZzkwMHA%3D!8!77.0.3865.75!1&amp;c&#x3D;1!0!x!6!4!1!24!640!360!0!5!0!x!1!d2luMzI%3D!1!0!0!0!0!1!3!x!d3d3LmppYW5zaHUuY29t!1!1!1!R29vZ2xlSW5jLn5BTkdMRShJbnRlbChSKUhER3JhcGhpY3M0NjAwRGlyZWN0M0QxMXZzXzVfMHBzXzVfMCk%3D!12!1!1!1!42!56!-1!-1!2585131335&amp;f&#x3D;83338</span><br><span class="line">                https:&#x2F;&#x2F;s5_cnzz_com&#x2F;z_stat.php?id&#x3D;1277762915&amp;web_id&#x3D;1277762915</span><br><span class="line">                https:&#x2F;&#x2F;vi12x_xcle_cn&#x2F;sucnew&#x2F;640x150&#x2F;20190909sg150.png</span><br><span class="line">        https:&#x2F;&#x2F;yun_lvehaisen_com&#x2F;h5-mami&#x2F;msdk&#x2F;tmk.js</span><br><span class="line">            https:&#x2F;&#x2F;engine_tuistone_com&#x2F;api&#x2F;v1&#x2F;activity&#x2F;get4web?request_id&#x3D;2NQi3x8zovefyJ6WYcB8c8K2L1Zz8Jn3Haz5vKiixtlv8Swe1574800139758&amp;app_key&#x3D;2NQi3x8zovefyJ6WYcB8c8K2L1Zz&amp;slotId&#x3D;304277&amp;device_id&#x3D;8Jn3Haz5vKiixtlv8Swe1574800139758&amp;callback&#x3D;jsonp_0020308437386842737</span><br><span class="line">            https:&#x2F;&#x2F;engine_tuistone_com&#x2F;api&#x2F;v1&#x2F;activity&#x2F;spm4web?slotId&#x3D;304277&amp;app_key&#x3D;2NQi3x8zovefyJ6WYcB8c8K2L1Zz&amp;device_id&#x3D;8Jn3Haz5vKiixtlv8Swe1574800139758&amp;activity_id&#x3D;2000017418%2C923%2C923&amp;sdk_type&#x3D;JSSDK&amp;sdk_version&#x3D;3.3.1&amp;sdk_source&#x3D;jianshu.com&amp;type&#x3D;0&amp;click_url&#x3D;https%3A%2F%2Factivity.tuipear.com%2Factivity%2Findex%3Fid%3D17418%26slotId%3D304277%26login%3Dnormal%26appKey%3D2NQi3x8zovefyJ6WYcB8c8K2L1Zz%26deviceId%3D8Jn3Haz5vKiixtlv8Swe1574800139758%26dsm%3D1.304277.0.0%26dsm2%3D1.304277.2.17418%26tenter%3DSOW%26subActivityWay%3D48%26tck_rid_6c8%3D0acc3777k3fjua4n-4603223%26tck_loc_c5d%3Dtactivity-17418%26dcm%3D401.304277.0.923%26&amp;data1&#x3D;0acc3777k3fjua4n-4603223&amp;data2&#x3D;%7B%22clickUrl%22%3A%22%2Factivity%2Findex%3Fid%3D17418%26slotId%3D304277%26login%3Dnormal%26appKey%3D2NQi3x8zovefyJ6WYcB8c8K2L1Zz%26deviceId%3D8Jn3Haz5vKiixtlv8Swe1574800139758%26dsm%3D1.304277.0.0%26dsm2%3D1.304277.2.17418%22%2C%22materJson%22%3A%22%7B%5C%22content%5C%22%3A%5C%22%5B%7B%5C%5C%5C%22imageUrl%5C%5C%5C%22%3A%5C%5C%5C%22%2F%2Fyun.tuitiger.com%2Fmami-media%2Fimg%2Fqm1eti6pdn.gif%5C%5C%5C%22%2C%5C%5C%5C%22width%5C%5C%5C%22%3A150%2C%5C%5C%5C%22height%5C%5C%5C%22%3A150%2C%5C%5C%5C%22msItemId%5C%5C%5C%22%3A22%7D%5D%5C%22%2C%5C%22gmtCreate%5C%22%3A1503470517000%2C%5C%22gmtModified%5C%22%3A1565093474000%2C%5C%22id%5C%22%3A923%2C%5C%22md5%5C%22%3A%5C%22DVt9EZ6wUcKxAg6mAseK8n%5C%22%2C%5C%22msId%5C%22%3A22%2C%5C%22pictureGroup%5C%22%3A%5C%224%5C%22%2C%5C%22pictureSize%5C%22%3A21%2C%5C%22pictureType%5C%22%3A%5C%220%5C%22%2C%5C%22pictureVal%5C%22%3A%5C%22150*150%5C%22%2C%5C%22title%5C%22%3A%5C%22%E6%91%87%E4%B8%80%E6%91%87%5C%22%7D%22%2C%22materialId%22%3A923%2C%22sckFromType%22%3A%22null%22%2C%22sckId%22%3A923%7D&amp;refer_host&#x3D;www.jianshu.com&amp;md&#x3D;&amp;timestamp&#x3D;&amp;nonce&#x3D;&amp;signature&#x3D;&amp;connect_type&#x3D;undefined&amp;callback&#x3D;jsonp_039959120667317904</span><br><span class="line">            https:&#x2F;&#x2F;yun_tuitiger_com&#x2F;mami-media&#x2F;img&#x2F;qm1eti6pdn.gif</span><br></pre></td></tr></table></figure>

<p>万恶之源都是这个 <code>2.c90dbb2ede007dc39cbf.js</code>，它加载了 <code>m301650.js</code> 和 <code>tmk.js</code> 这两个文件，似乎 <code>tmk.js</code> 是用来加载页面右下角的广告的。而另一个就是跳转到骗人下载安装包那个页面。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061814dh7le65h85vv7ovb.png" alt="页面右下角的广告"></p>
<p>这个 <code>m301650.js</code> 接入 cnzz 站长统计，看来访问量不小，都需要分析访客来源了。说不定分析之后还要针对性投放浏览器恶意下载页面呢。</p>
<h2 id="分析代码"><a href="#分析代码" class="headerlink" title="分析代码"></a>分析代码</h2><p>然后就是分析代码的目的了。</p>
<blockquote>
<p>这种明知道被 X 了，却不知道对面在做什么的感觉很难受。我非得把它扒的一干二净不可。</p>
</blockquote>
<p>我们需要分析一下 <code>m301650.js</code> <code>a.js</code> <code>tmk.js</code> 这三个文件，如果有需要的话也可以分析一下 <code>2.c90dbb2ede007dc39cbf.js</code>，看看恶意代码是怎样嵌入到项目主代码中的。</p>
<p>前方高能！想学技术的仔细瞧，吃瓜群众凑个热闹就行了。</p>
<h3 id="格式化代码"><a href="#格式化代码" class="headerlink" title="格式化代码"></a>格式化代码</h3><p>右键选择 Open in Sources panel。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061817zn91tcglpcolg6lo.png" alt="在资源面板中打开"></p>
<p>点击代码编辑器左下角的格式化代码按钮。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061820l0dkcpako0lmllmi.png" alt="格式化代码"></p>
<h3 id="尝试分析代码"><a href="#尝试分析代码" class="headerlink" title="尝试分析代码"></a>尝试分析代码</h3><p>然而事情并没有那么简单，简单浏览一下就会发现，这里有很多加密后的常量，还有疑似的解码算法。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061824b6f1bpffexr1sieo.png" alt="加密后的常量与疑似解码算法"></p>
<h3 id="解密字符串"><a href="#解密字符串" class="headerlink" title="解密字符串"></a>解密字符串</h3><p>这里有很多种方法，下断点是最容易的，依赖于 Chrome 强大的调试功能，轻松就能找到解密函数。</p>
<blockquote>
<p>动态调试往往比静态分析要简单。动态调试你能获取到程序运行时的第一手资料，静态调试只能靠一层层的推断。不过动态调试可能被检测出来，静态调试则没有这个问题。</p>
</blockquote>
<h4 id="方法-1：下断点调试"><a href="#方法-1：下断点调试" class="headerlink" title="方法 1：下断点调试"></a>方法 1：下断点调试</h4><p><img src="https://attach.52pojie.cn/forum/201912/09/061828wy2rxbf0zrfg6e0l.gif" alt="动态调试获取函数定义"></p>
<ol>
<li>先在被混淆函数 d 那一行下一个断点</li>
<li>刷新页面，重新执行一次这个函数，触发断点</li>
<li>直接在控制台输入被混淆的函数名 d，然后回车，调试工具会直接输出当前上下文环境中的 d 的值。</li>
</ol>
<p>这样我们很容易就能找到这个解密代码。</p>
<h4 id="方法-2：尝试搜索所有动态语句"><a href="#方法-2：尝试搜索所有动态语句" class="headerlink" title="方法 2：尝试搜索所有动态语句"></a>方法 2：尝试搜索所有动态语句</h4><p>如果我们直接找不到某个变量或函数名，那么他应该是动态生成的。</p>
<ol>
<li>搜索 eval, new Function 动态执行语句</li>
<li>查找 String.fromCharCode, String.charAt 等可能动态生成标识符的函数</li>
</ol>
<p>先搜索 eval，这种加密虽然最简单，但对于大多数不懂的人也是足够有效的。</p>
<blockquote>
<p>二八定律处处存在，可能这个加密只是最简单的那 20% 的加密方法，但他却能阻止 80% 的人破解代码。（比例不一定对，但是这种现象是经常存在的）</p>
</blockquote>
<p><code>m301650.js</code> 中只有一处 eval</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">p, a, c, k, e, d</span>) </span>&#123;</span><br><span class="line">    e = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.toString(<span class="number">36</span>)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&#x27;&#x27;</span>.replace(<span class="regexp">/^/</span>, <span class="built_in">String</span>)) &#123;</span><br><span class="line">        <span class="keyword">while</span> (c--) &#123;</span><br><span class="line">            d[c.toString(a)] = k[c] || c.toString(a)</span><br><span class="line">        &#125;</span><br><span class="line">        k = [<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> d[e]</span><br><span class="line">        &#125;];</span><br><span class="line">        e = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;\\w+&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        c = <span class="number">1</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">while</span> (c--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k[c]) &#123;</span><br><span class="line">            p = p.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;\\b&#x27;</span> + e(c) + <span class="string">&#x27;\\b&#x27;</span>, <span class="string">&#x27;g&#x27;</span>), k[c])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line">&#125;(<span class="string">&#x27;6 d(b)&#123;5 a,c=&quot;&quot;;4(a=0;a&lt;b.1;a+=2)c+=3.7(8(b.e(a,a+2),9));f c&#125;&#x27;</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="string">&#x27;|length||String|for|var|function|fromCharCode|parseInt|16|||||slice|return&#x27;</span>.split(<span class="string">&#x27;|&#x27;</span>), <span class="number">0</span>, &#123;&#125;));</span><br></pre></td></tr></table></figure>

<p>解密很简单，把 <code>eval(...)</code> 括号中的部分放到控制台执行就行了（注意括号对应关系），输出的内容就是被加密的代码原始的样子。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061831xfv9y9mvydmn4jfk.gif" alt="解码 eval 的代码"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://tool.lu/js">https://tool.lu/js</a>，这个网站可以自动解密 eval 加密的 js 代码，把 <code>eval(...)</code> 粘贴进文本框，点击 <code>解密（Decrypt）</code> 即可解密到源码。你可以试试再点击 <code>加密（Encrypt）</code> 你会发现加密后的源码和我们之前看到的类似，看来这段代码的作者也是比较偷懒，直接用现成的加密方法了。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a, c = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> (a = <span class="number">0</span>; a &lt; b.length; a += <span class="number">2</span>) c += <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(b.slice(a, a + <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是我们要找的那个 <code>d</code> 函数。这个代码很容易理解，就是一个 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.hex2bin.php">hex2bin</a> 的功能，将十六进制字符串转换为二进制字符串。</p>
<blockquote>
<p>对于 JavaScript 这种动态性极强的语言，尽量还是采用第一种方式。</p>
</blockquote>
<p>比如 <code>d(&quot;7265676D6F64654669656C6431&quot;)</code>，先加载 <code>d</code> 函数，然后运行这条语句就行了。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061834ft3a3hpbbp04d40v.png" alt="解码一个字符串"></p>
<h3 id="批量解密字符串"><a href="#批量解密字符串" class="headerlink" title="批量解密字符串"></a>批量解密字符串</h3><p>上面知道了解密函数，但是我不想手动替换每一个加密的地方，我需要把所有 <code>d(...)</code> 自动解密。</p>
<p>上重量级武器——语法解析器！我使用了 <a target="_blank" rel="noopener" href="https://github.com/acornjs/acorn/tree/master/acorn">acorn</a> 这个解析器（Parser），将 js 代码转换成 AST（抽象语法树），使用 <a target="_blank" rel="noopener" href="https://github.com/acornjs/acorn/tree/master/acorn-walk">acorn-walk</a> 对 AST 中所有对 d 函数的调用都解码，最后再使用 <a target="_blank" rel="noopener" href="https://github.com/estools/escodegen">escodegen</a> 将 AST 转换回原来的代码。</p>
<blockquote>
<p>注意：你的电脑必须安装了 <a target="_blank" rel="noopener" href="https://nodejs.org/zh-cn/">Node.js</a> 才可以执行下面的步骤</p>
</blockquote>
<p>新建一个文件夹（例如附件的 <code>decoder/</code> 文件夹），进入这个文件夹。</p>
<p>首先安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install acorn acorn-walk escodegen</span><br></pre></td></tr></table></figure>

<p>然后新建一个文件（例如 <code>index.js</code>），并编写代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> acorn = <span class="built_in">require</span>(<span class="string">&#x27;acorn&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> walk = <span class="built_in">require</span>(<span class="string">&quot;acorn-walk&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> escodegen = <span class="built_in">require</span>(<span class="string">&#x27;escodegen&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a, c = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (a = <span class="number">0</span>; a &lt; b.length; a += <span class="number">2</span>) c += <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(b.slice(a, a + <span class="number">2</span>), <span class="number">16</span>));</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = fs.readFileSync(<span class="string">&#x27;../samples/m301650.js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ast = acorn.parse(content);</span><br><span class="line">walk.simple(ast, &#123;</span><br><span class="line">    <span class="function"><span class="title">CallExpression</span>(<span class="params">node</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.callee.name === <span class="string">&#x27;d&#x27;</span> &amp;&amp; node.arguments[<span class="number">0</span>].type === <span class="string">&#x27;Literal&#x27;</span>) &#123;</span><br><span class="line">            node.type = <span class="string">&#x27;Literal&#x27;</span>;</span><br><span class="line">            node.value = d(node.arguments[<span class="number">0</span>].value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> decodedContent = escodegen.generate(ast);</span><br><span class="line">fs.writeFileSync(<span class="string">&#x27;../samples/m301650.decoded.js&#x27;</span>, decodedContent);</span><br></pre></td></tr></table></figure>

<p>执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p>上面的脚本会自动读取原始代码 <code>../samples/m301650.js</code>，把解码后的代码写入 <code>../samples/m301650.decoded.js</code> 文件。</p>
<blockquote>
<p><code>../samples/m301650.js</code> 是我从之前那些链接手动下载的。</p>
</blockquote>
<h3 id="开始分析代码"><a href="#开始分析代码" class="headerlink" title="开始分析代码"></a>开始分析代码</h3><p>代码总共不到 900 行，认真阅读一下就会理解。</p>
<blockquote>
<p>这里谈谈一个我个人学习时的思想。学习可以大概分两种类型，第一种是教科书式学习，看教科书的目录就可以明白，它交给你所有的知识点，怎么组织知识结构由你自己来做。第二种是工具书式学习，用到什么查什么，没用到的东西虽然书上有，但是暂时不用去了解。在算法中，就类似于广度优先搜索和深度优先搜索。在数据缓存方面，就类似 eager load（饥饿）和 lazy load（懒加载）。在学校通常是第一种方式学习，在工作中通常是第二种方式学习。</p>
<p>这里的代码怎么阅读呢？也有两种方法，一个就是按照顺序读代码，了解各个函数的用途，然后再分析主程序。另外一个就是直接读主程序代码，先了解有哪些函数，但不需要看内容，然后分析主程序，主程序中调用了哪个函数，再去看那个函数。（放在 C 语言中，头文件就是存放那个函数声明的地方，其他语言中的 <code>include</code> <code>import</code> <code>require</code> <code>using</code> 也是做这个用的）</p>
</blockquote>
<blockquote>
<p>图灵机的思想就是“读取当前的状态→程序进行某种运算→最终写入新状态”。从这三个方面任意一方面开始像其他两方面展开分析都是可以的，但是从中间向两侧分析是最简单的。因为我们分析程序的目的就是了解程序究竟做了什么。（这个可以暂时不用理解，因为实战中多体会几次就会发现这样最方便）</p>
</blockquote>
<p>分析代码时，我们通常想找出那些影响整个程序状态的代码。在通常意义的破解中，就是找出对系统 API 的调用（分析跨模块调用）。在 js 中就是对浏览器内置的函数的调用。</p>
<p>这里先去除到暂时不会改变状态的代码（声明性的代码），单纯的声明变量或函数对程序是没有影响的。程序的第一层大致是这样的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">q, p</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params">b, a, c</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">v</span>(<span class="params">b, a, c, d</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params">b, a</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> n = &#123;</span><br><span class="line">    &#125;;</span><br><span class="line">    B.prototype = &#123;</span><br><span class="line">    &#125;;</span><br><span class="line">    A.prototype = &#123;</span><br><span class="line">    &#125;;</span><br><span class="line">    n.V = <span class="string">&#x27;https://ewn.hfqxjx.cn/ms/g.js&#x27;</span>;</span><br><span class="line">    n.N = <span class="string">&#x27;301650&#x27;</span>;</span><br><span class="line">    C(navigator.userAgent);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;f_1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> F = <span class="keyword">new</span> <span class="function"><span class="keyword">function</span> (<span class="params">b, a</span>) </span>&#123;</span><br><span class="line">    &#125;(navigator.userAgent, n);</span><br><span class="line">    q = <span class="keyword">new</span> B(q, p, n);</span><br><span class="line">    p = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        p = <span class="string">&#x27;u=&#x27;</span> + F.J();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;maCal_1&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> z = q.J(<span class="string">&#x27;kwashhhh&#x27;</span>);</span><br><span class="line">        p = p + <span class="string">&#x27;&amp;c=&#x27;</span> + z.pa;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;maCal_2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> t = n.u(<span class="string">&#x27;kwashhhhfgp&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!t &amp;&amp; z) &#123;</span><br><span class="line">            t = <span class="keyword">new</span> A().get(z.qa);</span><br><span class="line">            <span class="keyword">var</span> E = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">            E.setHours(<span class="number">48</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            n.v(<span class="string">&#x27;kwashhhhfgp&#x27;</span>, t, E);</span><br><span class="line">        &#125;</span><br><span class="line">        t &amp;&amp; (p = p + <span class="string">&#x27;!&#x27;</span> + t + <span class="string">&#x27;&amp;f=&#x27;</span> + <span class="built_in">Math</span>.floor(<span class="number">100000</span> * <span class="built_in">Math</span>.random() + <span class="number">1</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;macal_3&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _hmt = _hmt || [];</span><br><span class="line">        <span class="keyword">var</span> oscr = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>), osdiv = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        oscr.src = <span class="string">&#x27;https://s9.cnzz.com/z_stat.php?id=1277879054&amp;web_id=1277879054&#x27;</span>;</span><br><span class="line">        osdiv.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        osdiv.appendChild(oscr);</span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(osdiv);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;macal_4&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        n.h(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;https://ewn.hfqxjx.cn/ms/a.js?b=200473!301650!88!640!150!200&amp;&#x27;</span> + p);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (b) &#123;</span><br><span class="line">        n.l(b, <span class="string">&#x27;macal_5&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="string">&#x27;kwashhhh&#x27;</span>, <span class="string">&#x27;301650&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>其中 <code>A</code> <code>B</code> <code>v</code> <code>C</code> 函数都是声明，没有执行，暂时不用分析。<code>n</code> <code>B.prototype</code> <code>A.prototype</code> 基本上不用分析，因为他们基本上只是定义变量，不会修改全局状态。<code>n.V =</code> <code>n.N =</code> 修改的是程序的局部变量，对全局不会造成影响。</p>
<p><code>C(navigator.userAgent)</code> 是第一个需要分析的代码，后面的所有语句几乎都可能与全局状态有关，都需要分析。</p>
<p>等等！我们真的需要这么麻烦吗？上面的方法适用于静态分析，不过动态分析比静态分析要简单！我们只需要在程序的第一句话下断点，然后一直单步运行就可以走完程序的逻辑了。</p>
<h3 id="单步运行代码"><a href="#单步运行代码" class="headerlink" title="单步运行代码"></a>单步运行代码</h3><blockquote>
<p>在 Chrome DevTools 中 <code>F8</code> 是继续运行，<code>F10</code> 是单步步过，<code>F11</code> 是单步步入，<code>Shift + F11</code> 是执行跳出当前函数，更多快捷键可以在 <code>右上角的三点 &gt; Settings &gt; Shortcuts &gt; Debugger</code> 看到。</p>
</blockquote>
<h4 id="m301650"><a href="#m301650" class="headerlink" title="m301650"></a>m301650</h4><p>我新建了一个 <code>m301650.html</code> 里面只有一句话 <code>&lt;script src=&quot;m301650.decoded.js&quot;&gt;&lt;/script&gt;</code> 这样我们可以打开这个本地的网页就可以进行测试了，同时这样也不会有其他代码的干扰。</p>
<p>这个过程虽然不难，但是非常的枯燥，用文字叙述也十分麻烦，此处省略，直接给出分析结果。</p>
<p>这个脚本收集了 <code>window</code> <code>navigator</code> 对象提供的各种各样的信息，例如：计算机或手机品牌型号、计算机操作系统（Windows、Linux、Mac OS、Android、iOS）、版本、CPU 核心数、浏览器种类（Chrome、IE、Opera、Firefox、Edge、Safari、微信、QQ、360、小米、OPPO、百度）、版本、排版引擎（WebKit、Trident、Gecko）、WEBGL 渲染引擎版本、Canvas Fingerprint、屏幕宽度、高度、色彩深度、是否支持触摸、触控点数、是否开启 Cookie、是否支持 LocalStorage、SessionStorage、IndexedDB。</p>
<p>这个脚本最后会加载 <code>https://ewn_hfqxjx_cn/ms/a.js</code> 并附加上这些获取的参数。<code>a.js</code> 又会做一堆事情，我们继续分析。</p>
<h4 id="a"><a href="#a" class="headerlink" title="a"></a>a</h4><p>这个 <code>a.js</code> 并没有做什么过分的事情，脚本会在页面某个位置添加一个图片，例如下面这个页面中间京东的广告。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061837d28vy0ojmlx62458.png" alt="a.js 的广告"></p>
<p>这个广告看上去像是简书自己添加的，不是什么恶意广告，只是域名让人看起来非常可疑。</p>
<p>不过，让我觉得很烦的是。到目前为止，我刚分析了 2 个 js 文件，就已经加载了 3 个 cnzz 的统计脚本了。我已经将 cnzz.com 加入我的屏蔽域名中了。</p>
<h3 id="反混淆工具"><a href="#反混淆工具" class="headerlink" title="反混淆工具"></a>反混淆工具</h3><h4 id="tmk"><a href="#tmk" class="headerlink" title="tmk"></a>tmk</h4><p>这个脚本也很复杂，也是单步调试慢慢看。在我心情烦躁时，我尝试搜索了一下 <code>Reverse uglify js</code>，我发现了 <a target="_blank" rel="noopener" href="http://jsnice.org/">http://jsnice.org</a> 这个网站，真的跟网站域名说的一样，Nice!</p>
<p>他可以自动推断值的类型，并据此来重命名变量，例入通过 <code>var a = document.createElement(&#39;script&#39;)</code>，会被转换成 <code>var script_element = document.createElement(&#39;script&#39;)</code>。他还会把 uglify 中常用的 <code>&amp;&amp;</code> 和 <code>||</code> 转换成 <code>if (xxx)</code> 或者 <code>if (!xxx)</code>，总之就是一个字：爽！</p>
<p>代码的内容并不复杂，<code>tmk.js</code> 只提供了一个 <code>TuiSDK</code> 类，真正调用的地方在 <code>2.c90dbb2ede007dc39cbf.js</code> 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> TuiSDK(&#123;</span><br><span class="line">    container: t,</span><br><span class="line">    appKey: <span class="string">&quot;2NQi3x8zovefyJ6WYcB8c8K2L1Zz&quot;</span>,</span><br><span class="line">    slotId: <span class="string">&quot;304277&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个广告使用 jsonp 返回数据，这个广告 SDK 只是根据这个返回值在网页上添加一个图标和一个链接，虽然这个广告图片特别像那种流氓网站（下面这张图片右下角的“送”字），但其实并没做什么过分的事情。</p>
<!-- ![tmk.js 的广告](images/12-ad.png) -->

<p>不过 jsonp 不仅仅可以返回数据，还是可以植入代码的，这个 SDK 是否可信我不太清楚，我测试的时候没有发现 jsonp 加载恶意代码的情况。</p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p>到目前为止都并没有脚本修改跳转链接，也没有往剪贴板中写入数据，看来问题回到了最开始调用他们的 <code>2.js</code> 中，难道是简书出现了内鬼？我黑我自己？我们来分析 <code>2.js</code></p>
<p>这个脚本没有混淆字符串，直接搜索链接就可以搜索出很多可以的网址。直接搜索 <code>//(.+?\.)+.+?/</code> 这个正则表达式。</p>
<ul>
<li>showTui: <code>//yun_lvehaisen_com/h5-mami/msdk/tmk.js</code></li>
<li>jumpTui: <code>https://engine_seefarger_com/index/activity?appKey=44oLpJM9AkUsZMnyoGDaEZQfADeo&amp;adslotId=296981</code></li>
<li>clickShengyao: <code>https://cm_bilibili_com/mgk/page/284698023573377024/</code></li>
<li>insertGT: <code>https://ad_lflucky_com/janes/js/jans.js</code></li>
<li>goZhangxin: <code>http://newspool_zhangxinzhixun_com/waifangsspgrlm/s1/index.html?appKey=7271ef91d1d5113</code></li>
<li>insertAMC: <code>https://ox86_xu7b_com/m301650.js</code></li>
<li>fetchSoHoAd: <code>//statics_itc_cn/aap/prod/js/1.0.0/sohu_aap.js</code></li>
<li><code>.gu-pao-ad</code>: <code>https://www_jianshu_com/p/428251ede1aa</code></li>
</ul>
<p>好多广告，包括最后一个站内链接也是广告，接广告没啥问题，主要是某些广告平台的跳转页面令人恶心，谁知道什么时候会下载一个病毒或流氓软件，感觉太不靠谱了。</p>
<h3 id="关于浏览器检测"><a href="#关于浏览器检测" class="headerlink" title="关于浏览器检测"></a>关于浏览器检测</h3><h4 id="jans"><a href="#jans" class="headerlink" title="jans"></a>jans</h4><p>比如那个向剪贴板写入淘口令的就是 <code>https://ad_lflucky_com/janes/js/jans.js</code>。这么多淘口令，一天两个，不带重样的。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061840qb0qbgon6qk6y4rb.png" alt="淘口令代码"></p>
<p>这个脚本里面也有用户隐私统计。不过值得注意的是，他甚至根据各种浏览器的特性（例如：电脑端不支持这个 UA 不可能拥有这个功能），判断出哪些浏览器信息是经过伪造的，然后上报这些伪造数据。</p>
<p>例如我用 PC 版 Chrome 模拟 Android Chrome 时，就会是下面这样的结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.platform</span><br><span class="line"><span class="string">&quot;Win32&quot;</span></span><br><span class="line">navigator.userAgent</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Mobile Safari/537.36&quot;</span></span><br></pre></td></tr></table></figure>

<p>统计脚本发现 <code>platform</code> 为 <code>Win32</code> 而 UA 中写的却是 Linux，则他会认为我是假的 OS，新建了一个 iframe，链接为 <code>https://ad_lflucky_com/janes/fk.html?fk=fakeOS</code>，这个 iframe 的内容很简单，就是一个 cnzz 的统计脚本。</p>
<blockquote>
<p>这个想法很有意思，把 cnzz 当做一个计数器，自己都不需要动态的服务器，只需要部署静态文件就可以进行数据统计了。</p>
</blockquote>
<p>此外他还会利用各种特性检测假浏览器、假信息、假语言、假分辨率。例如：</p>
<ul>
<li><code>navigator.productSub</code> 在 IE 上时 <code>undefined</code>，在 Safari 类浏览器下为 <code>20030107</code></li>
<li><code>eval.toString().length</code> 在不同浏览器上不同</li>
<li><code>object.toSource()</code> 仅在 Firefox 类浏览器上受支持。</li>
<li><code>screen.height</code> 不能比 <code>screen.availHeight</code> 小，因为前者是屏幕高度，后者是去除任务栏后的浏览器窗口可用的高度。</li>
</ul>
<h3 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h3><p>我其实很好奇为什么电脑端没有触发跳转到下载浏览器 apk 那个广告，我怀疑能是脚本对浏览器真伪进行了检测，只有真正的安卓端才会弹。</p>
<p>绕过方式也不难。Chrome 支持远程调试，我可以拿一台 Android 真机来运行 Chrome，这样就可以避免所有的检测。</p>
<h4 id="开启调试"><a href="#开启调试" class="headerlink" title="开启调试"></a>开启调试</h4><p>接上 USB 线，打开开发者选项，打开 USB 调试。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061843cv3hmy3wz06hqvim.png" alt="允许调试"></p>
<p>打开 <a href="chrome://inspect">chrome://inspect</a></p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061845dpprsklhzojhakoz.png" alt="Chrome Inspect"></p>
<p>正常的话直接点 <code>inspect</code> 就可以了。这里有个问题，如果无法访问 Google 的话，不能正常使用这个 inspect，Chrome 提供了一种备选方案，当 PC 端 Chrome 版本低于 Android Chrome 时，<code>inspect fallback</code> 会出现，我需要用些小技巧让他强制出现。</p>
<p>在这个页面打开 F12 开发者工具，在 Sources 中找到 Overrides，启用，然后选择一个本地文件夹保存文件（例如：我选择的是 <code>D:\Temp\chrome-local-override</code>）。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061847c12m2errrqzvpnev.png" alt="激活 Local Override"></p>
<p>切换到 Page，找到 <code>inspect.js</code>，搜索 <code>fallback</code>，找到这两行注释掉，然后 <code>Ctrl + S</code> 保存。你会发现文件图标上多了一个紫色的小点。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061850e6fqny3z8639nrgn.png" alt="修改脚本"></p>
<p>刷新页面，就会显示 inspect fallback 功能了。（Local Override 只会在开着 DevTools 时启用，关闭开发者工具之后，就会取消文件替换功能。）</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061852n4hmfx7zxyhdxy99.png" alt="inspect fallback"></p>
<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p><img src="https://attach.52pojie.cn/forum/201912/09/061854kgkgh5gui5ssgize.png" alt="恶意软件弹窗"></p>
<p>看到这个加载记录，我们可以明确了 <code>m301650.js -&gt; a.js -&gt; d.js -&gt; p7090z.html</code> 这一个过程了，</p>
<p>其中可以看到一堆 <code>d.js</code> 的加载，仔细看看都是 302 重定向。点开看详情，全都是各种 App 的跳转（网址域名中的点 <code>.</code> 已经替换成下划线 <code>_</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">openapp.jdmobile:&#x2F;&#x2F;virtual?params&#x3D;&#123;&quot;category&quot;:&quot;jump&quot;,&quot;des&quot;:&quot;m&quot;,&quot;url&quot;:&quot;https:&#x2F;&#x2F;u_jd_com&#x2F;UKBirM&quot;,&quot;keplerID&quot;:&quot;0&quot;,&quot;keplerFrom&quot;:&quot;1&quot;,&quot;kepler_param&quot;:&#123;&quot;source&quot;:&quot;kepler-open&quot;,&quot;otherData&quot;:&#123;&quot;mopenbp7&quot;:&quot;0&quot;&#125;,&quot;channel&quot;:&quot;cedad4c0ad02455c9a818f1b3d98da1a&quot;&#125;,&quot;union_open&quot;:&quot;union_cps&quot;&#125;</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;878928_xyz&#x2F;2019llq_5&#x2F;m.878928.xyz&#x2F;7090.html</span><br><span class="line"></span><br><span class="line">openapp.jdmobile:&#x2F;&#x2F;virtual?params&#x3D;&#123;&quot;category&quot;:&quot;jump&quot;,&quot;des&quot;:&quot;m&quot;,&quot;url&quot;:&quot;https:&#x2F;&#x2F;u_jd_com&#x2F;M7fTMi&quot;,&quot;keplerID&quot;:&quot;0&quot;,&quot;keplerFrom&quot;:&quot;1&quot;,&quot;kepler_param&quot;:&#123;&quot;source&quot;:&quot;kepler-open&quot;,&quot;otherData&quot;:&#123;&quot;mopenbp7&quot;:&quot;0&quot;&#125;,&quot;channel&quot;:&quot;2de699902eec4131927c7b68871512b3&quot;&#125;,&quot;union_open&quot;:&quot;union_cps&quot;&#125;</span><br><span class="line"></span><br><span class="line">vipshop:&#x2F;&#x2F;goHome?tra_from&#x3D;tra%3AC01V4m36ysoz00q7%3A%3Amig_code%3A1xx1%3Aac013b3kbkgv6tsf9mhia46zu7m1fufx</span><br><span class="line"></span><br><span class="line">tbopen:&#x2F;&#x2F;m_taobao_com&#x2F;tbopen&#x2F;index.html?source&#x3D;auto&amp;action&#x3D;ali.open.nav&amp;module&#x3D;h5&amp;bootImage&#x3D;0&amp;spm&#x3D;2014.ugdhh.2200612145320.219258-1604-32768&amp;bc_fl_src&#x3D;growth_dhh_2200612145320_219258-1604-32768&amp;materialid&#x3D;219258&amp;h5Url&#x3D;https%3A%2F%2Fh5.m.taobao.com%2Fbcec%2Fdahanghai-jump.html%3Fspm%3D2014.ugdhh.2200612145320.219258-1604-32768%26bc_fl_src%3Dgrowth_dhh_2200612145320_219258-1604-32768</span><br><span class="line"></span><br><span class="line">tbopen:&#x2F;&#x2F;m_taobao_com&#x2F;tbopen&#x2F;index.html?source&#x3D;auto&amp;action&#x3D;ali.open.nav&amp;module&#x3D;h5&amp;bootImage&#x3D;0&amp;spm&#x3D;2014.ugdhh.2200612145320.219272-1604-32768&amp;bc_fl_src&#x3D;growth_dhh_2200612145320_219272-1604-32768&amp;materialid&#x3D;219272&amp;h5Url&#x3D;https%3A%2F%2Fh5.m.taobao.com%2Fbcec%2Fdahanghai-jump.html%3Fspm%3D2014.ugdhh.2200612145320.219272-1604-32768%26bc_fl_src%3Dgrowth_dhh_2200612145320_219272-1604-32768</span><br><span class="line"></span><br><span class="line">newsapp:&#x2F;&#x2F;startup&#x2F;doc&#x2F;EVLBFM6D0001899O?s&#x3D;jixinkeji&amp;spsug&#x3D;ug&amp;spsugdate&#x3D;0&amp;spsugextend&#x3D;jixinkeji07</span><br><span class="line"></span><br><span class="line">uclink:&#x2F;&#x2F;www_uc_cn&#x2F;cc77796ca7c25dff9607d31b29effc07?action&#x3D;open_url&amp;src_pkg&#x3D;sxmhx&amp;src_ch&#x3D;sxmhx133&amp;src_scene&#x3D;pullup&amp;url&#x3D;ext%3Ainfo_flow_open_channel%3Ach_id%3D100%26insert_item_ids%3D4556851981770947449%26type%3Dmultiple%26from%3D6001</span><br><span class="line"></span><br><span class="line">uclink:&#x2F;&#x2F;www_uc_cn&#x2F;cc77796ca7c25dff9607d31b29effc07?action&#x3D;open_url&amp;src_pkg&#x3D;sxmhx&amp;src_ch&#x3D;sxmhx134&amp;src_scene&#x3D;pullup&amp;url&#x3D;ext%3Ainfo_flow_open_channel%3Ach_id%3D100%26insert_item_ids%3D4556851981770947449%26type%3Dmultiple%26from%3D6001</span><br></pre></td></tr></table></figure>

<p>这里面的第二个就是那个恶意软件的页面，PC 版 Chrome 打开直接提示危险网页。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061857hs2nj7xgsly92722.png" alt="危险网页"></p>
<p>不知道为什么，这些链接都没有成功打开。可能因为跳转到新页面，直接把 Pending 的 Response 都 Cancel 了。</p>
<h4 id="分析跳转流程"><a href="#分析跳转流程" class="headerlink" title="分析跳转流程"></a>分析跳转流程</h4><p>他们似乎对 IP 有检测，我再次访问这个链接时，并没有关于刚才那些链接的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;ewn_hfqxjx_cn&#x2F;ms&#x2F;a.js?b&#x3D;200473!301650!88!640!150!200&amp;u&#x3D;5!8.1.0!3!1!bWltYXgz!8!78.0.3904.96!1&amp;c&#x3D;1!2!Y2VsbHVsYXI%3D!3!8!7!24!786!393!0!5!0!x!3!bGludXhhcm12OGw%3D!1!1!1!0!0!1!1!x!d3d3LmppYW5zaHUuY29t!1!1!1!UXVhbGNvbW1%2BQWRyZW5vKFRNKTUxMg%3D%3D!13!1!1!1!33!62!-1!-1!2276550266&amp;f&#x3D;90265</span><br></pre></td></tr></table></figure>

<p>似乎重新换一个 IP 有用，并且也可能跟时间有关，可能是每 1 个小时刷新某些东西（这里不确定）。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061900osn2d22ysszs9ss6.png" alt="跳转到恶意下载页面的代码"></p>
<p>这个 <code>a.js</code> 是动态生成的，里面的广告图片链接每次刷新都会变，跳转到恶意下载的那部分代码，通常时候是没有的，换 IP 之后会出现 1 次。</p>
<p>这个跳转流程并不复杂，就是根据 <code>d.js</code> URL 中的 <code>n=1157258&amp;a=125977</code> 这个参数使用 <code>location.href</code> 跳转到各个不同的 URL。具体可以看上面的代码图片（或 <code>./samples/a.v2.js</code>）。</p>
<p>里面这个 <code>https://nw44_zmlled_cn/js/mob/sjas.js</code> 脚本又通过 iframe 引入了另外一个页面 <code>https://dqj77_bkyhq_cn/js/tmp/ImgTj.html</code>，这个页面包含大量 img 标签，可能都是用来进行访问统计的，真的恐怖，有必要搞这么多吗？</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061902ovvzvgn72rdnoenb.png" alt="植入的页面代码"></p>
<h4 id="分析-URL-参数"><a href="#分析-URL-参数" class="headerlink" title="分析 URL 参数"></a>分析 URL 参数</h4><p>我们可以具体明确一下 URL 中的那些参数都是哪些浏览器数据。生成这些数据的代码都在 <code>m301650.js</code>（因为 <code>a.js</code> 是从 <code>m301650.js</code> 发起的）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x3D;200473!301650!88!640!150!200&amp;u&#x3D;5!8.1.0!3!1!bWltYXgz!8!78.0.3904.96!1&amp;c&#x3D;1!2!Y2VsbHVsYXI%3D!3!8!7!24!786!393!0!5!0!x!3!bGludXhhcm12OGw%3D!1!1!1!0!0!1!1!x!d3d3LmppYW5zaHUuY29t!1!1!1!UXVhbGNvbW1%2BQWRyZW5vKFRNKTUxMg%3D%3D!13!1!1!1!33!62!-1!-1!2276550266</span><br></pre></td></tr></table></figure>

<p><code>b=200473!301650!88!640!150!200</code> 是固定值，然后后面分为 <code>u</code> <code>c</code> <code>f</code> 三部分，<code>f</code> 是一个随机数。</p>
<p>我的浏览器 User Agent 是 <code>Mozilla/5.0 (Linux; Android 8.1.0; MI MAX 3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.96 Mobile Safari/537.36</code> 你可以找到这些数据。</p>
<h5 id="u"><a href="#u" class="headerlink" title="u"></a>u</h5><table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">原始内容</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5</td>
<td align="left"></td>
<td align="left">Windows = 1, Mac OS = 2, Linux, 模拟器 = 4, Android = 5</td>
</tr>
<tr>
<td align="left">8.1.0</td>
<td align="left"></td>
<td align="left">系统版本</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"></td>
<td align="left">UA 包含 <code>mi</code> = 3</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">手机 = 1, 平板 = 2, iPod = 3, 模拟器 = 4, 桌面 = 5</td>
</tr>
<tr>
<td align="left">bWltYXgz</td>
<td align="left">mimax3</td>
<td align="left">设备制造商</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"></td>
<td align="left">浏览器种类：Safari = 1, AppleWebKit = 2, MSIE = 3, IEMobile 或 Windows CE 或 Windows Phone 或 WP7 = 4, Opera = 5, Namoroka = 5, Shiretoko = 5, Firefox = 6, Minefield = 6, Netscape = 7, Chrome = 8, chromeframe = 9, UCWEB = 10, QQBrowser 或 MQQBrowser = 11, 360EE = 12, MicroMessenger = 13, QQ = 14, 华为手机或其他 = 15, miuibrowser = 16, oppobrowser = 17, baiduboxapp = 18</td>
</tr>
<tr>
<td align="left">78.0.3904.96</td>
<td align="left"></td>
<td align="left">浏览器版本</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">渲染引擎：WebKit 或 AppleWebKit = 1, KHTML = 2, Gecko = 3, Presto = 4, Trident = 5</td>
</tr>
</tbody></table>
<h5 id="c"><a href="#c" class="headerlink" title="c"></a>c</h5><table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">原始内容</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>document.cookieEnabled</code> 启用 Cookie = 1, 不启用 = 0, 获取出错 = -1</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"></td>
<td align="left"><code>navigator.connection</code> 网络类型：Wi-Fi = 2, 移动网络 = 1, 其他 = 0</td>
</tr>
<tr>
<td align="left">Y2VsbHVsYXI%3D</td>
<td align="left">cellular</td>
<td align="left"><code>navigator.connection.type</code> 详细网络类型（Wi-Fi 或蜂窝网络 2G、3G、4G，未知 = x）</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"></td>
<td align="left"><code>history.length</code> 访问历史长度</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"></td>
<td align="left"><code>navigator.hardwareConcurrency</code> CPU 线程数</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"></td>
<td align="left">如果 Cookie 有 <code>kwashhhhnrfr</code> 则直接返回，否则判断 Referer：未知 = 1, baidu.com = 2, .google. = 3, sogou.com = 4, so.com = 5, m.sm.cn = 6, bing.com = 7, 本站 = 8, 然后再将这些写入 Cookie</td>
</tr>
<tr>
<td align="left">24</td>
<td align="left"></td>
<td align="left"><code>screen.colorDepth</code> 色彩深度</td>
</tr>
<tr>
<td align="left">786</td>
<td align="left"></td>
<td align="left"><code>screen.width</code> 屏幕的长边像素</td>
</tr>
<tr>
<td align="left">393</td>
<td align="left"></td>
<td align="left"><code>screen.height</code> 屏幕的短边像素</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left"></td>
<td align="left"><code>window !== top</code> 是否被嵌入：被嵌入 = 1, 顶级页面 = 0</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"></td>
<td align="left"><code>navigator.userAgent</code> 操作系统类型：windows = 1, mac = 2, linux = 3, iphone 或 ipad = 4, android = 5, windows phone = 6</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left"></td>
<td align="left"><code>navigator.oscpu</code> 操作系统和 CPU 类型：win = 1, mac = 2, linux = 3, 其他 = 11</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left"></td>
<td align="left"><code>navigator.oscpu</code> 具体值，没有 = x</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"></td>
<td align="left"><code>navigator.platform</code> 平台类型：win = 1, mac = 2, linux = 3, android = 3, pike = 3, ipad 或 ipod 或 iphone = 4, 其他 = 12, 如果不支持 <code>navigator.plugins</code> 并且 UA 不是 Windows 或 Windows Phone = 13</td>
</tr>
<tr>
<td align="left">bGludXhhcm12OGw%3D</td>
<td align="left"><code>linuxarmv8l</code></td>
<td align="left"><code>navigator.platform</code></td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>navigator.maxTouchPoints</code> 最大触摸点数</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">45 分钟新访客：在 Cookie 中设置一个 <code>kwashhhhuuxs</code> 记录从本周周一 0 点开始到现在的分钟数，如果不存在返回 1，超过 45 分钟再次访问或无法解析返回 2，否则返回 0</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">今日新访客：如果 Cookie <code>kwashhhhuuxx</code> 存在则返回 0，不存在设为 12 过期时间设为明天 0 点，返回 1</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left"></td>
<td align="left">距离上次访问过去天数，使用 <code>kwashhhhudd</code> 记录 <code>访问时间 / 86400 * 86400,今年访问天数</code>，计算得出</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left"></td>
<td align="left">今年访问天数，如果上两行的今日新访客为 1 则今年访问天数 + 1</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left">PV: 对当前 <code>location.href</code> 进行 Hash，然后在 Cookie 中记录访问次数</td>
</tr>
<tr>
<td align="left">x</td>
<td align="left"></td>
<td align="left">x</td>
</tr>
<tr>
<td align="left">d3d3LmppYW5zaHUuY29t</td>
<td align="left"><a target="_blank" rel="noopener" href="http://www.jianshu.com/">www.jianshu.com</a></td>
<td align="left"><code>document.domain</code>，如果没有则用 <code>obj.referrer</code> 中的 host</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>window.localStorage</code> 可用</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>window.sessionStorage</code> 可用</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>window.indexedDB</code> 可用</td>
</tr>
<tr>
<td align="left">UXVhbGNvbW1%2BQWRyZW5vKFRNKTUxMg%3D%3D</td>
<td align="left">Qualcomm~Adreno(TM)512</td>
<td align="left">WEBGL_debug_renderer_info <code>gl.getParameter(ext.UNMASKED_VENDOR_WEBGL) + &quot;~&quot; + gl.getParameter(ext.UNMASKED_RENDERER_WEBGL)</code></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"></td>
<td align="left"><code>document.getElementsByTagName(&quot;script&quot;).length</code></td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>navigator.maxTouchPoints</code> 最大触摸点数</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>document.createEvent(&quot;TouchEvent&quot;)</code> 是否支持触摸事件</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left"></td>
<td align="left"><code>&quot;ontouchstart&quot; in window</code></td>
</tr>
<tr>
<td align="left">33</td>
<td align="left"></td>
<td align="left"><code>document.title.length</code>      标题长度</td>
</tr>
<tr>
<td align="left">62</td>
<td align="left"></td>
<td align="left"><code>document.getElementsByTagName(&quot;div&quot;).length</code>  div 个数</td>
</tr>
<tr>
<td align="left">-1</td>
<td align="left"></td>
<td align="left"><code>document.getElementById(&#39;kwashhhh&#39;).offsetLeft</code> 嵌入的 div 被排版在什么位置</td>
</tr>
<tr>
<td align="left">-1</td>
<td align="left"></td>
<td align="left"><code>document.getElementById(&#39;kwashhhh&#39;).offsetTop</code></td>
</tr>
<tr>
<td align="left">2276550266</td>
<td align="left"></td>
<td align="left">由各种浏览器参数组成的 Hash，包括：localStorage sessionStorage indexedDB WEBGL_debug_renderer_info <code>navigator.maxTouchPoints</code> <code>document.createEvent(&quot;TouchEvent&quot;)</code> <code>&quot;ontouchstart&quot; in window</code> oscpu platform userAgent <code>navigator.language</code> colorDepth 屏幕宽高 <code>document.body.addBehavior</code> openDatabase IE ActiveXObject <code>navigator.plugins</code> Canvas Fingerprint</td>
</tr>
</tbody></table>
<h2 id="为什么会出现这种问题"><a href="#为什么会出现这种问题" class="headerlink" title="为什么会出现这种问题"></a>为什么会出现这种问题</h2><p>引入未经验证的其他域的脚本</p>
<p>本案例中其他域的脚本不在自己网站的可控范围内，不论其是否可信，都应该尝试进行监控，避免对网站用户带来不必要的损失。</p>
<p>不知道法律上怎么判，但是假如用户通过简书页面加载的广告下载到了恶意 App，并造成了财产损失，简书肯定要承担责任，看就是看有没有人故意搞简书了。</p>
<p>只要使用 script 标签加载了其他域的脚本，当前网页就很难受你自己的控制了，他可以进行任何可能的操作，包括覆盖当前网页已有的比如 jQuery 库，甚至假如你的代码隔离不够，把某个 XHR 库暴露给全局了，他就可能拦截你所有的请求数据。</p>
<p>所以这种广告 SDK 尽量通过 CORS 跨域执行 XHR 请求，也不要盲目的使用 <code>&lt;script&gt;</code> 或 jsonp 加载不可控来源的脚本。</p>
<h2 id="前端开发者如何预防这种问题"><a href="#前端开发者如何预防这种问题" class="headerlink" title="前端开发者如何预防这种问题"></a>前端开发者如何预防这种问题</h2><p>这里讲的是如何预防，而不是如何解决。解决掉这个问题的方法只能是把所有依赖的 package 或 SDK 亲自过一遍。</p>
<p>JavaScript 不支持反射，你没法在运行时对其他代码进行检测。（当然，幸亏他不支持反射，否则你的完美隔离的代码和数据也可以被外来脚本获取到了）</p>
<p>所以这里只讲如何预防，预防的方法很简单，但是处理起来很麻烦。</p>
<h3 id="CSP-Content-Security-Policy-内容安全策略"><a href="#CSP-Content-Security-Policy-内容安全策略" class="headerlink" title="CSP (Content Security Policy 内容安全策略)"></a>CSP (Content Security Policy 内容安全策略)</h3><p>在 HTTP 返回头或 <code>&lt;meta&gt;</code> 中添加 <code>Content-Security-Policy</code>，即可限制资源来源，具体请参考 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy (CSP) - HTTP | MDN</a>。</p>
<p>处理完之后，在较新的浏览器中访问你的网页时，任何外部脚本攻击均不能执行。这些请求头让浏览器仅加载受控域名下的资源，任何企图使用来自其他域名的资源的操作都会直接报错。禁止加载来自未知域名的 JS 脚本，禁止使用未知域名的 CSS 样式文件，禁止使用未知域名的图片，甚至也禁止未知域名的内嵌 iframe，以及被其他域名以 iframe 形式引入。</p>
<p>优点是，你所有的东西都来自自己可控的域名下，缺点是你必须把所有你有的域名都列出来，包括执行内嵌代码都需要显示指出。</p>
<h4 id="来自-MDN-的示例"><a href="#来自-MDN-的示例" class="headerlink" title="来自 MDN 的示例"></a>来自 MDN 的示例</h4><p>一个网站管理者允许网页应用的用户在他们自己的内容中包含来自任何源的图片，但是限制音频或视频需从信任的资源提供者 (获得)，所有脚本必须从特定主机服务器获取可信的代码.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#39;self&#39;; img-src *; media-src media1.com media2.com; script-src userscripts.example.com</span><br></pre></td></tr></table></figure>

<p>在这里，各种内容默认仅允许从文档所在的源获取，但存在如下例外:</p>
<p>图片可以从任何地方加载 (注意 “*” 通配符)。<br>多媒体文件仅允许从 media1.com 和 media2.com 加载 (不允许从这些站点的子域名)。<br>可运行脚本仅允许来自于 userscripts.example.com。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>此外还有很多可用的安全选项。例如可以启用 HSTS 强制使用 HTTPS。声明 Cookie 为 HttpOnly 禁止 js 中获取 Cookie 内容。不过这些是防劫持用的而不是防止外部脚本的。</p>
<h2 id="其他相关的思考与感想"><a href="#其他相关的思考与感想" class="headerlink" title="其他相关的思考与感想"></a>其他相关的思考与感想</h2><h3 id="简书x百度"><a href="#简书x百度" class="headerlink" title="简书x百度"></a>简书x百度</h3><p>另外也不知道简书跟百度有什么交易，一个页面竟然加载了好几百个百度的资源。</p>
<p><img src="https://attach.52pojie.cn/forum/201912/09/061906qnwekebkoeeanfie.gif" alt="大量请求"></p>
<h3 id="概率性-Bug"><a href="#概率性-Bug" class="headerlink" title="概率性 Bug"></a>概率性 Bug</h3><p>概率性的 Bug 往往让人捉摸不透。作为一名程序员，改 Bug 也是常有的事情，碰到那些无法复现的 Bug 极为头疼，不过这个问题真的没有什么好的调试办法，只能不断的调试找到代码中可能有错误的位置。</p>
<p>不过换个方向思考一下，如果这不是一个 Bug，而是一个故意设的陷阱呢？部分游戏反外挂使用概率性封号、延迟封号的方法，让外挂制作者不知道到底是哪个功能过检测失败了。也有一种“蜜罐”方法，正常玩家不可能执行到“蜜罐”中的方法，而外挂制作者可以看到这部分代码，好好组织代码结构，让他我以为这段代码有用，可实际上一旦这段代码被执行到了，他会向服务器报告这个人使用了外挂。</p>
<p>本例中，目标网站的脚本是动态生成的，必须换 IP 才能抓到 1 次，这篇文章前前后后花了大约 2 周零零散散的时间。真的直到我发这篇文章的前一天我才真正抓到那个恶意跳转的脚本。</p>
<p>这种概率性 Bug 真的很麻烦。比如各种游戏的抽卡，如果玩家想要测试卡池概率有没有问题，只能大量花钱，靠频率接近概率的方式测试。</p>
<h3 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h3><p>Webpack 通过 bundle 的方式增加了网页的加载效率，但是这种打包容易让一些毫无用处的代码一起加入发布的版本中，不过这些都没有隐藏恶意代码这个问题严重。应该不会有人去查看 bundle 的代码吧，最多利用 map 文件看看引入了哪些文件。没有 webpack 时我们很明确我们依赖了哪些 js 文件，但有了 webpack，我们没有再专注于代码安全，接入广告商的 SDK 直接打包进 bundle 了，甚至都不知道其中有恶意代码。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>简书移动端页面会加载一堆 webpack bundle 其中的 <code>2.js</code> 包含广告功能，其中一个广告功能的代码加载了一个外部脚本。这个外部脚本是动态生成的，他会判断访问者的 IP，同 IP 每天第一次访问会跳转到恶意下载页面，之后不会再跳转。这个广告还接入了大量统计平台，加载一次页面就有好几百的请求。还另外一个广告也引入了外部代码，其中嵌入了向剪贴板中写入淘口令的指令。</p>
<p>本文分析了恶意代码对外的表现，基本弄清简书接入的广告的问题，主要目的还是学习和分享各种 JavaScript 动态调试技能。</p>
<p>希望简书尽快解决这个问题吧。（会不会简书内部已知，并且默许呢？）</p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/productSub">Navigator.productSub - Web APIs | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS) - HTTP | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin">Access-Control-Allow-Origin - HTTP | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy (CSP) - HTTP | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">Content-Security-Policy - HTTP | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">Strict-Transport-Security - HTTP | MDN</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">HTTP cookies - HTTP | MDN</a></li>
</ul>
<blockquote>
<p>最后，我自己经常说的一句话：所有能插入中间操作的代码都可以被调试破解。</p>
</blockquote>
</div><div class="article-licensing box"><div class="licensing-title"><p>简书网页劫持分析，浏览器指纹信息，使用 Chrome DevTools 调试 JavaScript 技巧，Android Chrome 远程调试，利用 CSP 预防劫持 (转载)</p><p><a href="http://example.com/2019/12/24/Web/简书网页劫持分析，使用-Chrome-DevTools-调试-JavaScript-技巧，利用-CSP-预防劫持/">http://example.com/2019/12/24/Web/简书网页劫持分析，使用-Chrome-DevTools-调试-JavaScript-技巧，利用-CSP-预防劫持/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>聪明的竹子</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2019-12-24</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-07-10</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/01/14/Vue/vue-cli3-0-%E4%BB%A5%E5%8F%8A-vue2-6-1%EF%BC%8C%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A7%BB%E5%8A%A8UI%E5%BA%93/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">vue-cli3.0 以及 vue2.6.1，从零开始搭建一个移动UI库</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/12/12/HTML/%E5%BD%BB%E5%BA%95%E7%90%86%E8%A7%A3%20innerWidth%E3%80%81outerWidth%E3%80%81screen.width%E3%80%81vw%20%E5%92%8C%20getBoundingClientRect%E7%9A%84%E5%8C%BA%E5%88%AB/"><span class="level-item">彻底理解 innerWidth、outerWidth、screen.width、vw 和 getBoundingClientRect的区别</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "23c4755694dbfedd1b4d4c24b1ffdc26",
            repo: "cleverbamboo.github.io",
            owner: "CleverBamboo",
            clientID: "11fad00a47acd0be0148",
            clientSecret: "1850b675a1b6b8afcffd7a2551a31697a4b99113",
            admin: ["CleverBamboo"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://tva1.sinaimg.cn/large/006tNbRwgy1g9ku3pe2uzj30go0go0to.jpg" alt="Alfred"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Alfred</p><p class="is-size-6 is-block">会写注释的开发</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>试玉要烧三日满，辨材须待七年期</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">74</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">13</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">17</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/CleverBamboo"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#摘要"><span class="level-left"><span class="level-item">1</span><span class="level-item">摘要</span></span></a></li><li><a class="level is-mobile" href="#问题引出"><span class="level-left"><span class="level-item">2</span><span class="level-item">问题引出</span></span></a></li><li><a class="level is-mobile" href="#目录"><span class="level-left"><span class="level-item">3</span><span class="level-item">目录</span></span></a></li><li><a class="level is-mobile" href="#抓包"><span class="level-left"><span class="level-item">4</span><span class="level-item">抓包</span></span></a></li><li><a class="level is-mobile" href="#分析-js-代码依赖关系"><span class="level-left"><span class="level-item">5</span><span class="level-item">分析 js 代码依赖关系</span></span></a></li><li><a class="level is-mobile" href="#分析代码"><span class="level-left"><span class="level-item">6</span><span class="level-item">分析代码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#格式化代码"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">格式化代码</span></span></a></li><li><a class="level is-mobile" href="#尝试分析代码"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">尝试分析代码</span></span></a></li><li><a class="level is-mobile" href="#解密字符串"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">解密字符串</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#方法-1：下断点调试"><span class="level-left"><span class="level-item">6.3.1</span><span class="level-item">方法 1：下断点调试</span></span></a></li><li><a class="level is-mobile" href="#方法-2：尝试搜索所有动态语句"><span class="level-left"><span class="level-item">6.3.2</span><span class="level-item">方法 2：尝试搜索所有动态语句</span></span></a></li></ul></li><li><a class="level is-mobile" href="#批量解密字符串"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">批量解密字符串</span></span></a></li><li><a class="level is-mobile" href="#开始分析代码"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">开始分析代码</span></span></a></li><li><a class="level is-mobile" href="#单步运行代码"><span class="level-left"><span class="level-item">6.6</span><span class="level-item">单步运行代码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#m301650"><span class="level-left"><span class="level-item">6.6.1</span><span class="level-item">m301650</span></span></a></li><li><a class="level is-mobile" href="#a"><span class="level-left"><span class="level-item">6.6.2</span><span class="level-item">a</span></span></a></li></ul></li><li><a class="level is-mobile" href="#反混淆工具"><span class="level-left"><span class="level-item">6.7</span><span class="level-item">反混淆工具</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#tmk"><span class="level-left"><span class="level-item">6.7.1</span><span class="level-item">tmk</span></span></a></li><li><a class="level is-mobile" href="#2"><span class="level-left"><span class="level-item">6.7.2</span><span class="level-item">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#关于浏览器检测"><span class="level-left"><span class="level-item">6.8</span><span class="level-item">关于浏览器检测</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#jans"><span class="level-left"><span class="level-item">6.8.1</span><span class="level-item">jans</span></span></a></li></ul></li><li><a class="level is-mobile" href="#远程调试"><span class="level-left"><span class="level-item">6.9</span><span class="level-item">远程调试</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#开启调试"><span class="level-left"><span class="level-item">6.9.1</span><span class="level-item">开启调试</span></span></a></li><li><a class="level is-mobile" href="#调试"><span class="level-left"><span class="level-item">6.9.2</span><span class="level-item">调试</span></span></a></li><li><a class="level is-mobile" href="#分析跳转流程"><span class="level-left"><span class="level-item">6.9.3</span><span class="level-item">分析跳转流程</span></span></a></li><li><a class="level is-mobile" href="#分析-URL-参数"><span class="level-left"><span class="level-item">6.9.4</span><span class="level-item">分析 URL 参数</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#为什么会出现这种问题"><span class="level-left"><span class="level-item">7</span><span class="level-item">为什么会出现这种问题</span></span></a></li><li><a class="level is-mobile" href="#前端开发者如何预防这种问题"><span class="level-left"><span class="level-item">8</span><span class="level-item">前端开发者如何预防这种问题</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#CSP-Content-Security-Policy-内容安全策略"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">CSP (Content Security Policy 内容安全策略)</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#来自-MDN-的示例"><span class="level-left"><span class="level-item">8.1.1</span><span class="level-item">来自 MDN 的示例</span></span></a></li></ul></li><li><a class="level is-mobile" href="#其他"><span class="level-left"><span class="level-item">8.2</span><span class="level-item">其他</span></span></a></li></ul></li><li><a class="level is-mobile" href="#其他相关的思考与感想"><span class="level-left"><span class="level-item">9</span><span class="level-item">其他相关的思考与感想</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#简书x百度"><span class="level-left"><span class="level-item">9.1</span><span class="level-item">简书x百度</span></span></a></li><li><a class="level is-mobile" href="#概率性-Bug"><span class="level-left"><span class="level-item">9.2</span><span class="level-item">概率性 Bug</span></span></a></li><li><a class="level is-mobile" href="#Webpack"><span class="level-left"><span class="level-item">9.3</span><span class="level-item">Webpack</span></span></a></li></ul></li><li><a class="level is-mobile" href="#总结"><span class="level-left"><span class="level-item">10</span><span class="level-item">总结</span></span></a></li><li><a class="level is-mobile" href="#相关链接"><span class="level-left"><span class="level-item">11</span><span class="level-item">相关链接</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CSS/"><span class="level-start"><span class="level-item">CSS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Example/"><span class="level-start"><span class="level-item">Example</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/GO/"><span class="level-start"><span class="level-item">GO</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/categories/HTML/"><span class="level-start"><span class="level-item">HTML</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/JAVASCRIPT/"><span class="level-start"><span class="level-item">JAVASCRIPT</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/REACT/"><span class="level-start"><span class="level-item">REACT</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Vue/"><span class="level-start"><span class="level-item">Vue</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Web/"><span class="level-start"><span class="level-item">Web</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="level-start"><span class="level-item">小程序</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">数据结构和算法</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"><span class="level-start"><span class="level-item">计算机</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="level-start"><span class="level-item">计算机网络</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%9A%8F%E5%BF%83%E6%89%80%E6%AC%B2/"><span class="level-start"><span class="level-item">随心所欲</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2021/07/08/GO/Go%E8%AF%AD%E8%A8%80Gin%E9%83%A8%E7%BD%B2Docker%E3%80%81Nginx%E3%80%81Supervisor%E3%80%81Redis%E3%80%81Mysql%E5%AE%8C%E6%95%B4%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B/"><img src="https://z3.ax1x.com/2021/07/08/RL84gO.jpg" alt="Go语言Gin部署Docker、Nginx、Supervisor、Redis、Mysql完整详细流程"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-07-08T03:38:22.000Z">2021-07-08</time></p><p class="title"><a href="/2021/07/08/GO/Go%E8%AF%AD%E8%A8%80Gin%E9%83%A8%E7%BD%B2Docker%E3%80%81Nginx%E3%80%81Supervisor%E3%80%81Redis%E3%80%81Mysql%E5%AE%8C%E6%95%B4%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B/">Go语言Gin部署Docker、Nginx、Supervisor、Redis、Mysql完整详细流程</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/06/08/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AD%EF%BC%89-%E7%BB%BC%E5%90%88%E7%AF%87%EF%BC%88%E7%88%B1%E7%A7%9F%E6%88%BF%E9%A1%B9%E7%9B%AE%EF%BC%89/"><img src="https://z3.ax1x.com/2021/04/27/g9kcmd.png" alt="微服务实战Go Micro v3 系列（六）- 综合篇（爱租房项目）"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-06-08T07:20:17.000Z">2021-06-08</time></p><p class="title"><a href="/2021/06/08/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AD%EF%BC%89-%E7%BB%BC%E5%90%88%E7%AF%87%EF%BC%88%E7%88%B1%E7%A7%9F%E6%88%BF%E9%A1%B9%E7%9B%AE%EF%BC%89/">微服务实战Go Micro v3 系列（六）- 综合篇（爱租房项目）</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/06/02/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%94%EF%BC%89-%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"><img src="https://z3.ax1x.com/2021/04/27/g9kcmd.png" alt="微服务实战Go Micro v3 系列（五）- 注册和配置中心"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-06-02T08:53:44.000Z">2021-06-02</time></p><p class="title"><a href="/2021/06/02/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%94%EF%BC%89-%E6%B3%A8%E5%86%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/">微服务实战Go Micro v3 系列（五）- 注册和配置中心</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/05/12/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-Pub-Sub/"><img src="https://z3.ax1x.com/2021/04/27/g9kcmd.png" alt="微服务实战Go Micro v3 系列（四）- 事件驱动(Pub/Sub)"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-05-12T09:22:37.000Z">2021-05-12</time></p><p class="title"><a href="/2021/05/12/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-Pub-Sub/">微服务实战Go Micro v3 系列（四）- 事件驱动(Pub/Sub)</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/04/28/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89-%E5%90%AF%E5%8A%A8HTTP%E6%9C%8D%E5%8A%A1/"><img src="https://z3.ax1x.com/2021/04/27/g9kcmd.png" alt="微服务实战Go Micro v3 系列（三）-启动HTTP服务"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-04-28T03:14:46.000Z">2021-04-28</time></p><p class="title"><a href="/2021/04/28/GO/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98Go-Micro-v3-%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89-%E5%90%AF%E5%8A%A8HTTP%E6%9C%8D%E5%8A%A1/">微服务实战Go Micro v3 系列（三）-启动HTTP服务</a></p><p class="categories"><a href="/categories/GO/">GO</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/02/"><span class="level-start"><span class="level-item">February 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">December 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">June 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/1995/01/"><span class="level-start"><span class="level-item">January 1995</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/CSS/"><span class="tag">CSS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Example/"><span class="tag">Example</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GO/"><span class="tag">GO</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HTML/"><span class="tag">HTML</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Web/"><span class="tag">Web</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">小程序</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B8%83%E5%B1%80/"><span class="tag">布局</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"><span class="tag">网络安全</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/"><span class="tag">计算机</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="tag">计算机网络</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9A%8F%E5%BF%83%E6%89%80%E6%AC%B2/"><span class="tag">随心所欲</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tag">面试</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4136865331374316" data-ad-slot="pub-4136865331374316" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://i.loli.net/2019/12/05/7WUKpFrsMSxv9jB.png" alt="聪明的竹子博客" height="28"></a><p class="is-size-7"><span>&copy; 2021 聪明的竹子</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>